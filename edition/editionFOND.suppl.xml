<?xml version="1.0" encoding="UTF-8"?>

<!-- Menu Editions Activité "FOND " suplementaire !-->
<!-- version="6.8" !-->
<!-- si possible de faire fonctionne des cond dans les menu -->
<!-- si possible de fermer des Item par default -->
<!-- 6.7 mise en place de la fonction page break -->
<!-- 6.8 resultats officiels relais avec entete -->
<!-- 6.9 amelioration liste de départ -->
<edition>
	<menu>
		<menu title="Edition Relais" image="./res/32x32_ranking.png" bold="false" cond ="($(Epreuve.Code_discipline)='RELAIS')">
			<menu title="Liste Départ Relais (1-a)" image="./res/16x16_official.png"  Officiel="0" first_header="0" id="Lst_Relais" DossardRelais="Lettre"/>
			<menu title="Liste Départ Relais (1-a) Officiels" image="./res/16x16_official.png"  Officiel="1" first_header="1" id="Lst_Relais" DossardRelais="Lettre"/>
			<menu title="Liste Départ Relais (1/²)" image="./res/16x16_official.png" id="Lst_Relais" DossardRelais="Numeric"/>
			<menu title="Résultats Officieux Relais (1-a)" image="./res/16x16_official.png" id="res_Relais" Officiel="0" DossardRelais="Lettre" />
			<menu title="Résultats Officiels Relais (1-a)" image="./res/16x16_official.png" id="res_Relais" Officiel="1" DossardRelais="Lettre" />
			<menu title="Résultats Relais (1/²)" image="./res/16x16_official.png" id="res_Relais" DossardRelais="Numeric" />
			<menu title="Résultats Tours (1-a)" image="./res/16x16_official.png" id="res_Tour" DossardRelais="Lettre" />
		</menu>
		
		<menu title="Analyse des Performances" image="./res/32x32_options.png">
			<menu title="Analyse des différences entre chaque temps inter" image="./res/16x16_ranking.png" id="res_DiffInter" header="1" first_header="0" choix_manche="1"/>
			<menu title="Résultats Skiathlon" image="./res/16x16_ranking.png" id="res_Skiathlon" header="1" first_header="0" choix_manche="1"/>
		</menu>
		
		<menu title="Gestion des Points de Passage et LAP" image="./res/32x32_options.png">
			<menu title="Configuration des points de passages" image="./res/16x16_text.png" lua="./edition/Config_Passage.lua"  />
			<menu title="Résultats Avec inter Multi Lap avec Tps et Clt cumulés" image="./res/16x16_ranking.png" id="res_inter_Multi_Lap" Cumul="1" mode_lap="1" header="1" first_header="0" passage="1" choix_manche="1"/>
			<menu title="Résultats Avec inter Multi Lap avec Tps et Clt au tour" image="./res/16x16_ranking.png" id="res_inter_Multi_Lap" Cumul="0" mode_lap="1" header="1" first_header="0" passage="1" choix_manche="1"/>
		</menu>
		
		<menu title="Outils" image="./res/32x32_options.png">
			<menu title="Edition des Séquences Chrono" image="./res/16x16_bib.png" id="chrono_seq" choix_manche="1" action="chrono_seq"/>
			<menu title="Configuration des points de passages" image="./res/16x16_text.png" lua="./edition/Config_Passage.lua"  />
			<menu title="Transfert du Clt d'un Evt X Ds la colonne Ordre_niveau et du Crietre Coursexx Dans la course sélectionner pour attribution des Dossards suivant le Clt de l'Evt xx" image="./res/16x16_fis.png" lua="./edition/Clt_EprX-ColOrdre_niveau.lua" Colum_Ref="Clt"/>
			<menu title="Transfert de la colonne Odre_niveau d'un Evt X Ds la colonne Ordre_niveau et du Ctrietre Coursexx Dans la course sélectionner pour attribution des Dossards suivant le Clt de l'Evt xx" image="./res/16x16_fis.png" lua="./edition/Clt_EprX-ColOrdre_niveau.lua" Colum_Ref="Ordre_niveau"/>
			<menu title="Transfert du Clt et des ponits d'un Cha. X Ds la colonne Pts_Best pour attribution des Dossards suivant le Clt de l'Evt X" image="./res/16x16_fis.png" Label_col="Pts_best" lua="./edition/ColPtsClt_ColPtsBest.lua" />
			<menu title="Transfert du Clt et des ponits d'un Cha. X Ds la colonne Centre pour attribution des Dossards suivant le Clt de l'Evt X" image="./res/16x16_fis.png" Label_col="Centre" lua="./edition/ColPtsClt_ColPtsBest.lua" />		
		</menu>
		
		<menu title="Outils Dossards FIS" image="./res/32x32_options.png">
			<menu title="Transfert de la colonne Points (FIS Distance) dans la Colonne Pts_best" image="./res/16x16_fis.png" LabelPts="FIS_Dist" colum_Pts="Pts_best" LabelNc="NC_FIS_Dst" Colum_Label="Moniteur" lua="./edition/PtsFFS_ColPtsBest.lua" />
			<menu title="Transfert de la colonne Points (FFS) dans la Colonne Pts_Clt" image="./res/16x16_fis.png" LabelPts="FFS" colum_Pts="PtsClt" LabelNc="NC_FFS" Colum_Label="Niveau" lua="./edition/PtsFFS_ColPtsBest.lua" />
			<menu title="Transfert de la colonne Points (FIS Sprint) dans la Colonne Pts" image="./res/16x16_fis.png" LabelPts="FIS_Spr" colum_Pts="Pts" LabelNc="NC_FIS_Spr" Colum_Label="Info" lua="./edition/PtsFFS_ColPtsBest.lua" />
			<menu title="Start List pour controle avec les 3 colonnes Pts (FFS, Fis Distance, Fis sprint) par Ordre de dossards" image="./res/16x16_official.png" id="lst_FIS" Qrcode="0" officiel="0" />			
			<menu title="Par Nation / Comité" image="./res/16x16_ranking.png" id="part_NatClub" first_header="0" orderby="Nation" choix_manche="1" /></menu>
		
		<menu title="Utilitaires" image="./res/32x32_options.png">
			<menu title="Factures inscriptions" image="./res/16x16_text.png" lua="./edition/facture.lua"  />
			<menu title="Récapitulatif du Nb d'inscrits par épreuve sexe et catégorie" image="./res/16x16_text.png" id="uti_recapilatif" />
			<menu title="Tableau de service" image="./res/16x16_pdf.png" id="Tab_services" />
			<menu title="Podium par épreuve Dames et Hommes" image="./res/16x16_text.png" id="uti_podium" />
			<menu title="Saisie d'un rapport d'accident" image="./res/16x16_text.png" lua="./edition/Rapport_accident.lua"  />
			<menu title="Edition d'un rapport d'accident" image="./res/16x16_text.png" lua="./edition/editionRapport_accident.lua"  />
			<menu title="Télécharger le Rapport d'accident (PDF remplisable)" image="./res/16x16_pdf.png" action="open ./edition/Rapport_Accident.pdf" />
		</menu>
		
		<menu title="Editions Supplémentaires" image="./res/32x32_options.png">
			<menu title="Edition du Timing Report FIS" image="./res/16x16_fis.png" id="timing_report" lua="./edition/editionTR_FIS.lua" />
			<menu title="Calcul d'un temps manuel" image="./res/16x16_calc.png" id="temps_manuel" lua="./edition/tempsManuel.lua" />
			<menu title="formulaire d'inscription FIS" image="./res/16x16_fis.png">
				<menu title="Gestion des officiels" image="./res/16x16_fis.png" impression="0" gestion="1" lua="./edition/entryFIS_ALP.lua" />
				<menu title="Edition du formulaire" image="./res/16x16_fis.png" impression="1" gestion="0" lua="./edition/entryFIS_ALP.lua" />
			</menu>
			<menu title="Regroupement de coureurs" image="./res/16x16_compute.png" lua="./edition/editionRegroupement.lua" />
		</menu>
		
		<menu title="Edition UNSS" image="./res/32x32_juges.png">
			<menu title="Par Dossard Equipe" image="./res/16x16_official.png" id="part_UNSS" />
			<menu title="Résultats des 2 meilleurs" image="./res/16x16_official.png" Nb_BestTime="2" lua="./edition/best3TimeUNSS.lua" />
			<menu title="Résultats des 3 meilleurs" image="./res/16x16_official.png" Nb_BestTime="3" lua="./edition/best3TimeUNSS.lua" />
			<menu title="Résultats des 4 meilleurs" image="./res/16x16_official.png" Nb_BestTime="4" lua="./edition/best3TimeUNSS.lua" />
			<menu title="Résultats Patrouille" image="./res/16x16_official.png" lua="./edition/LastTimeUNSS.lua" />
		</menu>
		
	</menu>

	<!-- header standard !-->
	<header>
		<spacing all="0"/>
		<background mode="transparent"/>
		<font name="Calibri" size="14" adjust="max" weight="bold"/>
		<lua>
			entite = $(Evenement.Code_entite)
			discipline = $(Epreuve.Code_discipline)
			type_edition = id:sub(1,4)
			officiel = tonumber(params.officiel)
			Regroupement = $(Epreuve.Code_regroupement)
			if type_edition == 'Lst_' and discipline ~= 'RELAIS' then
				Titre = 'Liste de départ \n '..params.title
			elseif type_edition == 'part' then
				Titre = 'Liste de Participants \n '..params.title
			else
				Titre = title
			end
			flagQrCode = 0;
			if params ~= nil and params.Qrcode ~= nil then flagQrCode = params.Qrcode end
		</lua>	
		<text row="auto" col="1" align="center">$(Evenement.Nom)</text>
		<text row="auto" align="center" cond="discipline ~= 'RELAIS'">$(Discipline.Libelle)</text>
		<text row="auto" align="center" cond="discipline == 'RELAIS'">$(Discipline.Libelle)..' '..SexeEpreuve</text>
		<text row="auto" align="center" cond="params.code_epreuve ~= -1">$(Categorie{$(Epreuve.Code_categorie)}.Libelle)..' - '..$(Sexe{$(Epreuve.Sexe)}.Libelle)</text>
		<text row="auto" align="center" >Titre</text>
		<row h="0.5cm"/>
		<matrix row_start="-3" row_end="0" col_start="10" col_end="0">
			<row h="1.5cm" />
			<col w="1, 1.5cm" />
			<qrcode adjust="best" col_start="2" cond="tonumber(params.Qrcode)==1 and entite=='FFS' ">'https://live.ffs.fr/live_timing/live_cc.php?codex='..$(Epreuve.Fichier_transfert)</qrcode>
			<qrcode adjust="best" col_start="2" cond="tonumber(params.Qrcode)==1 and entite=='FIS' and $(Evenement.Commentaire_live):len() &gt; 0">'live.fis-ski.com/lv-al'..string.sub($(Epreuve.Fichier_transfert),4)..'.htm#/short'</qrcode>
		</matrix>
		<!-- affichage de la ligne d'heure de départ en massstart ou fond pop si pas de first header -->
		<lua>if type_edition == 'lst_' and first_header == '0' and discipline:In('MASS','POURS-D', 'FP') and $(Epreuve.Heure_depart):len() &gt; 0 then</lua>
		<call option="Ligne_H_depart" cond="editor:GetPageCurrent() == 1" file="./edition/options.xml"/>
		<lua>end</lua>
		<!-- affichage du Compteur des classés si c'est un resultat (id commence par 'res_' et si le first header n'est pas actif) -->
		<lua>if type_edition == 'res_' and first_header == '0' then</lua>
			<call option="stat_ranking" cond="editor:GetPageCurrent() == 1" file="./edition/options.xml"/>
		<lua>else </lua>
		<row value="0.4cm" />
		<lua>end </lua>
	</header>
				
	<!-- first_header standard !-->
	<first_header >
		<background mode="transparent"/>
		<font name="Calibri" size="9" adjust="best" weight="normal"/>
		<pen border="none" />
		<call option="identiteOfficiel" file="./edition/options.xml"/>
		<lua>
			type_edition = id:sub(1,4)
			entite = $(Evenement.Code_entite)
			discipline = $(Epreuve.Code_discipline)
		</lua>
		<col w="6,5,2, 0.2cm,4,4,1, 0.2cm,4,4,1" />

		<row h="auto" />
		<text col_start="1" col_end="3" align="center" underlined="1" font_size_step="1" font_weight="bold">'JURY DE COMPETITION'</text>
		<text col_start="5" col_end="7" align="center" underlined="1" font_size_step="1" font_weight="bold">'CARACTERISTIQUES DE LA PISTE'</text>
		<text col_start="9" col_end="11" align="center" underlined="1" font_size_step="1" font_weight="bold">'RENSEIGNEMENTS'</text>
		<row h="0.1cm" />

		<row h="auto" />
		<text col_start="1" align="left">'DELEGUE TECHNIQUE '..entite..':'</text>
		<text col_start="2" col_end="3" align="left">GetIdentiteOfficiels('TechnicalDelegate')</text>
		<text col_start="5" align="left" >'Nom du Site :'</text>
		<text col_start="6" align="left" >$(Pistes.Nom_piste)</text>
		<text col_start="9" align="left">'Lieu :'</text>
		<text col_start="10" col_end="0" align="right" >$(Epreuve_Nordique.Lieu)</text>
	
		<row h="auto" />
		<text col_start="1" align="left">'DT Adjoint :'</text>
		<text col_start="2" col_end="3" align="left">GetIdentiteOfficiels('TECHNICALDELEGATEASSISTANT')</text>
		<text col_start="5" align="left" >'Point Haut :'</text>
		<text col_start="6" align="left" >$(Epreuve.Point_haut)</text>
		<text col_start="9" align="left">'Categorie :'</text>
		<text col_start="10" col_end="0" align="right" >$(Categorie{$(Epreuve.Code_categorie)}.Libelle)</text>

		<row h="auto" />
		<text col_start="1" align="left">'DIRECTEUR D\'EPREUVE :'</text>
		<text col_start="2" col_end="3" align="left">GetIdentiteOfficiels('RACEDIRECTOR')</text>
		<text col_start="5" align="left" >'Point Bas :'</text>
		<text col_start="6" align="left" >$(Epreuve.Point_bas)</text>
		<text col_start="9" align="left">'Sexe :'</text>
		<text col_start="10" col_end="0" align="right" >$(Sexe{$(Epreuve.Sexe)}.Libelle)</text>
		
		<row h="auto" />
		<text col_start="1" align="left">'CHEF DE PISTE :'</text>
		<text col_start="2" col_end="3" align="left">GetIdentiteOfficiels('ChiefCompetition')</text>
		<text col_start="5" align="left" >'Montée maxi. :'</text>
		<text col_start="6" align="left" >$(Epreuve.Montee_maxi)</text>
		<text col_start="9" align="left">'Distance épreuve :'</text>
		<text col_start="10" col_end="0" align="right" >$(Epreuve.Distance):Suffix(' Km')</text>
		
		<row h="auto" />
		<text col_start="1" align="left">'COORDONNATEUR- '..entite..':'</text>
		<text col_start="2" align="left">GetIdentiteOfficiels('COORDINATOR')</text>
		<text col_start="5" align="left" >'Montée Totale. :'</text>
		<text col_start="6" align="left" >$(Epreuve.Montee_tot)</text>
		<text col_start="9" align="left">'Style :'</text>
		<lua>
			if $(Epreuve.Style) == 'L' then Style = 'Libre' 
			elseif $(Epreuve.Style) == 'C' then Style = 'Classique' 
			elseif $(Epreuve.Style) == 'C+L' then Style = 'Classique + Libre' 
			elseif $(Epreuve.Style) == 'L+C' then Style = 'Libre + Classique' end 
		</lua>
		<text col_start="10" col_end="0" align="right" >Style</text>
		
		<!-- mise en place de ligne verticale -->
		<line col_start="4" row_start="-5" row_end="0" pen_color="dkgray" border="mid_vert" />
		<line col_start="8" row_start="-5" row_end="0" pen_color="dkgray" border="mid_vert" />
		
		<row h="auto" />
		<lua>
			tClub = base:GetTable('Club')
			base:TableLoad(tClub, "Select * From Club Where Nom_reduit = '"..$(Evenement.Club):EscapeQuote().."'")
		</lua>
		<text col_start="1" col_end="4" align="left">'Club organisateur : '..$(Club.Nom_complet)</text>
		<text col_start="6" col_end="10" align="left" >'Organisateur : '..$(Evenement.Organisateur) </text>
		<!-- retour a la ligne de 0.1cm		 -->
		<row h="0.2cm" />
		<row value="auto" />
		<line col_start="1" col_end="0" pen_color="dkgray" border="top" />
		<row h="auto" />
		<text col_start="1" align="left">'Météo : '..$(Epreuve_Nordique.Meteo)</text>
		<text col_start="2" align="left">'Liste : '..$(Evenement.Code_liste)</text>
		<text col_start="5" col_end="6" align="left" >'Codex Epreuve : '..$(Epreuve.Fichier_transfert) </text>
		<text col_start="8" col_end="9" align="left" >'Coéficient F : '..$(Discipline.Facteur_f)</text>
		<text col_start="10" align="left" cond="params.title=='Résultats Officiels'" >'Penalitée : '..$(Epreuve.Penalite_appliquee)</text>

		<!-- affichage de la ligne d'heure de départ en massstart ou fond pop -->
		<lua>if type_edition == 'lst_' and discipline:In('MASS','POURS-D', 'FP') then</lua>
		<call option="Ligne_H_depart" cond="editor:GetPageCurrent() == 1" file="./edition/options.xml"/>
		<!-- affichage du Compteur des classés si c'est un resultat -->
		<lua>elseif type_edition == 'res_' then</lua>
			<call option="stat_ranking" cond="editor:GetPageCurrent() == 1" file="./edition/options.xml"/>
		<lua>else </lua>
		<row value="0.4cm" />
		<lua>end </lua>

	</first_header>
	
	<!-- footer standard !-->
	<footer>
		<background mode="transparent"/>
		<font name="Calibri" size="8" adjust="best" weight="normal"/>
		<pen border="none" />

		<lua>entite = entite or $(Evenement.Code_entite)</lua>
		<lua>info = $(Epreuve.Date_epreuve,'%2D/%2M/%4Y')..' / '..$(Evenement.Station)..' ('</lua>
		<lua cond="entite=='FIS'">info = info..$(Evenement.Code_nation)..'-'</lua>
		<lua>info = info..$(Evenement.Code_comite).. ') / '..$(Evenement.Organisateur)</lua>
		<text row="auto" col="1" align="left">info</text>
		<text align="right" font_weight="bold" cond="entite=='FIS'">$(Epreuve.Fichier_transfert_int)..' (Liste n°'..$(Evenement.Code_liste)..')'</text>
		<text align="right" font_weight="bold" cond="entite=='FFS'">$(Epreuve.Fichier_transfert)..' (Liste n°'..$(Evenement.Code_liste)..')'</text>
		<line col_start="1" col_end="0" pen_size="2" pen_color="dkgray" border="bottom"/>
		<!-- <text row="auto" align="left"><pen border="top" />app.GetName()..' Version '..app.GetVersion()..' (FFS - ESF - Agil Informatique) - '..os.date('Edité le %d-%m-%Y à %H:%M:%S')</text> -->
		
		<row h="auto" />
		<matrix col_start="1">
			<row h="auto"/>
			<text col="auto" align="left">app.GetName()..' Version '..app.GetVersion()..' / FFS'</text>
			<image col="0.4cm" adjust="width" align="left">'./res/32x32_ffs.png'</image>
			<text col="auto" align="left" adjust="width">' / ESF'</text>
			<image col="0.4cm" adjust="width" align="left">'./res/32x32_esf.png'</image>
			<text col="auto" align="left">' / Agil Informatique'</text>
			<image col="0.4cm" adjust="width" align="left">'./res/32x32_agil.png'</image>
			<text col="auto" align="left">os.date(' / Edité le %d-%m-%Y à %H:%M:%S')</text>
		</matrix>	
		<text align="right">string.format('Page %d/%s',editor:GetPageCurrent(), editor:GetPageCountLabel())</text>
		<line col_start="1" col_end="0" border="top" />
		<text row="auto" align="left" cond="editor:GetPageCurrent() == 1">$(Evenement.Commentaire)</text>
	</footer>

	<!-- Résultats diff inter -->
	<report id="res_DiffInter" title="(params.title or '')" header="1" first_header="0" >
		<lua>Nb_tps_inter = base:GetTable('Epreuve_Nordique'):GetCellInt('Nb_temps_inter', 0, 1) or 1</lua>
		<!-- <paper orientation="landscape" cond="Nb_tps_inter >= 4 "/> -->
		<!-- création des colonne dans le body -->
		<column name="Diff_I2_I1" type="chrono" />
		<column name="Rank_Diff_I2_I1" type="ranking" />
		<column name="Diff_I3_I2" type="chrono" />
		<column name="Rank_Diff_I3_I2" type="ranking" />
		<column name="('Diff_Tps'..manche..'_I'..tonumber(Nb_tps_inter))" type="chrono" />
		<column name="('Rank_Diff_Tps'..manche..'_I'..tonumber(Nb_tps_inter))" type="ranking" />
		<lua>
			ColTpsX = 'Tps'..manche
			ColTpsInterX = 'Tps'..manche..'_inter'..Nb_tps_inter 
			ColdiffTpsinterx = 'Diff_Tps'..manche..'_I'..Nb_tps_inter
			ColRankTpsinterx = 'Rank_Diff_Tps'..manche..'_I'..Nb_tps_inter
			ColrefOrderX = 'Diff_Tps'..manche..'_I'..Nb_tps_inter..', Dossard Desc'
			body:ComputeSubtractTime(ColdiffTpsinterx, ColTpsX, ColTpsInterX)
			body:SetRanking(ColRankTpsinterx, ColrefOrderX)
		</lua>
		<column name="Tps_status">chrono.Status(body:GetCellInt('Tps'..manche, row))</column>
		<lua>
			body:SetCounter('Tps_status')
			for m=1,Nb_tps_inter do
				if tonumber(m) >= 2 then
					ColTps2 = 'Tps'..manche..'_inter'..m 
					ColTps1 = 'Tps'..manche..'_inter'..m-1 
					Coldiffinter = 'Diff_I'..m..'_I'..m-1
					colRankdiff = 'Rank_Diff_I'..m..'_I'..m-1
					j = m-1
					ColrefOrder = 'Diff_I'..m..'_I'..j..', Dossard Desc'
					body:ComputeSubtractTime(Coldiffinter, ColTps2, ColTps1)
					body:SetRanking(colRankdiff, ColrefOrder)
				
				end
			end
		</lua>
			
		<lua>
			type_edition = id:sub(1,4)
			body:SetCounter('Tps_status')
			entite = $(Evenement.Code_entite)
			nb_manche = base:GetTable('Epreuve'):GetCellInt('Nombre_de_manche', 0, 1)
		</lua>
		
		<order key="('Tps'..manche..', Dossard Desc')" />
		
		<rupture key="Tps_status">
			<before cond="$(Tps_status) ~= 'ok'">
				<font size="14"/>
				<lua>local status = $(Tps_status)</lua>
				<row h="0.4cm"/>
				<text row="auto" col="1" >ranking.Code(status)..' - '..ranking.Label(status)..' ('..body:GetCounterValue('Tps_status', status)..')'</text>
			</before>
		</rupture>
		


		<body>
			<row h="auto" />
			<row h="auto" />
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font name="calibri" size="9" adjust="ellipsize" />
			<spacing all="2" />
			<spacing left="7" right="10" top="2" bottom="2" />
			<col w="1cm"/>
			<text row_start="1" row_end="0" align="center" label="('Clt'..manche)" font_weight="bold" font_size_step="1"><background mode="solid" color="green" cond="(body:GetCell('Clt'..manche ,row)) == '1'" /><font color="white" cond="$(Clt) == '1'"/>body:GetCell('Clt'..manche ,row)</text>
			<col w="1cm"/>
			<text row_start="1" row_end="0" align="center" label="Dos.">$(Dossard)</text>
	
			<col w="5cm"/>
				<text row_start="1">''</text> 
				<background mode="transparent" />
				<text row_start="1" align="left" label="Identité  - Code coureur">$(Identite)</text> 
				<text row_start="1" align="right" >$(Code_coureur):sub(4)</text> 
				<background mode="solid" />
				<text row_start="2" align="left" label="Club - (CS.)">$(Club)..' - '..$(Comite{$(Comite)}.Nom):Parenthesis()</text> 
			<col w="2cm"/>
				<text row_start="1" align="center" label="Categ.(Cltc.)">$(Categ)..' - '..$(Cltc):Parenthesis()</text> 
				<text row_start="2" align="center" label="Sexe - An">$(Sexe)..' - '..$(An)</text> 
			<col w="0.5cm"/>
			<text row_start="1" row_end="0" border="1"></text>
				<matrix col_start="0" row_start="1" row_end="0">
					<row h="auto" />
					<row h="auto" />
					<lua>
						for m=1,Nb_tps_inter do;
							if tonumber(m) == 1 then
						</lua>	
								<col w="2cm" />
								<text row_start="1" row_end="0" col_start="1" align="right" label="('Inter'..m..'(Clt)')" ><background mode="solid" color="blue" cond="$(Clt1_inter1) == '1'" /><font color="white" cond="$(Clt1_inter1) == '1'"/>$(Tps1_inter1)..' '..$(Clt1_inter1):Parenthesis()</text>	
						<lua>	
							else
								j = m-1
						</lua>
								<col w="2.5cm" />
								<text row_start="1" col_start="(m)" align="right" label="('Inter'..m)" ><background mode="solid" color="blue" cond="group =='body' and (body:GetCell('Clt'..manche..'_inter'..m ,row)) == '1'" /><font color="white" cond="(body:GetCell('Clt'..manche..'_inter'..m ,row)) == '1'"/>body:GetCell('Tps'..manche..'_inter'..m ,row)..' '..body:GetCell('Clt'..manche..'_inter'..m ,row):Parenthesis()</text> 
								<text row_start="2" col_start="(m)" align="left" label="('Diff.I'..m..'/ I'..j..'(Clt)')" ><background mode="solid" color="yellow" cond="group =='body' and (body:GetCell('Rank_Diff_I'..m..'_I'..m-1,row)) == '1'" />body:GetCell('Diff_I'..m..'_I'..m-1,row)..' '..body:GetCell('Rank_Diff_I'..m..'_I'..m-1,row):Parenthesis()</text>
						<lua>end
						end
					</lua>
						
					<col w="2.5cm" />
						<text row_start="1" col_start="(Nb_tps_inter+1)" align="right" label="('Tps'..manche)" ><background mode="solid" color="green" cond="(body:GetCell('Clt'..manche,row)) == '1'" /><font color="white" cond="(body:GetCell('Clt'..manche,row)) == '1'"/>body:GetCell('Tps'..manche,row)..' '..body:GetCell('Clt'..manche,row):Parenthesis()</text> 
						<text row_start="2" col_start="(Nb_tps_inter+1)" align="left" label="(ColdiffTpsinterx..'(Clt)')" ><background mode="solid" color="yellow" cond="(body:GetCell(ColRankTpsinterx,row)) == '1'" />body:GetCell(ColdiffTpsinterx,row)..' '..body:GetCell(ColRankTpsinterx,row):Parenthesis()</text> 
						
						<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
						
				</matrix>				
						
		</body>

	</report>	
	
		<!-- Résultats Skiathlon -->
	<report id="res_Skiathlon" title="(params.title or '')" header="1" first_header="0" >
		<lua>Nb_tps_inter = base:GetTable('Epreuve_Nordique'):GetCellInt('Nb_temps_inter', 0, 1) or 2</lua>
		<!-- <lua>Nb_tps_inter = 2</lua> -->
		<!-- <lua>Nb_tps_inter = base:GetTable('Epreuve_Alpine_Manche'):GetCellInt('Nb_temps_inter', 0, 1)</lua> -->
		<!-- <paper orientation="landscape" cond="Nb_tps_inter >= 4 "/> -->
		
		<!-- création des colonne dans le body -->
		<column name="Diff_I2_I1" type="chrono" />
		<column name="Rank_Diff_I2_I1" type="ranking" />
		<column name="Diff_I3_I2" type="chrono" />
		<column name="Rank_Diff_I3_I2" type="ranking" />
		<column name="('Diff_Tps'..manche..'_I'..Nb_tps_inter)" type="chrono" />
		<column name="('Rank_Diff_Tps'..manche..'_I'..Nb_tps_inter)" type="ranking" />
		<lua>
			ColTpsX = 'Tps'..manche
			ColTpsInterX = 'Tps'..manche..'_inter'..Nb_tps_inter 
			ColdiffTpsinterx = 'Diff_Tps'..manche..'_I'..Nb_tps_inter
			ColRankTpsinterx = 'Rank_Diff_Tps'..manche..'_I'..Nb_tps_inter
			ColrefOrderX = 'Diff_Tps'..manche..'_I'..Nb_tps_inter..', Dossard Desc'
			body:ComputeSubtractTime(ColdiffTpsinterx, ColTpsX, ColTpsInterX)
			body:SetRanking(ColRankTpsinterx, ColrefOrderX)
		</lua>
		<column name="Tps_status">chrono.Status(body:GetCellInt('Tps'..manche, row))</column>
		<lua>body:SetCounter('Tps_status')</lua>
		<lua>
			for m=1,Nb_tps_inter do
				if tonumber(m) >= 2 then
					ColTps2 = 'Tps'..manche..'_inter'..m 
					ColTps1 = 'Tps'..manche..'_inter'..m-1 
					Coldiffinter = 'Diff_I'..m..'_I'..m-1
					colRankdiff = 'Rank_Diff_I'..m..'_I'..m-1
					j = m-1
					ColrefOrder = 'Diff_I'..m..'_I'..j..', Dossard Desc'
					body:ComputeSubtractTime(Coldiffinter, ColTps2, ColTps1)
					body:SetRanking(colRankdiff, ColrefOrder)
				
				end
			end
		</lua>
			
		<lua>
			type_edition = id:sub(1,4)
			body:SetCounter('Tps_status')
			entite = $(Evenement.Code_entite)
			nb_manche = base:GetTable('Epreuve'):GetCellInt('Nombre_de_manche', 0, 1)
		</lua>
		
		<order key="('Tps'..manche..', Dossard Desc')" />
		
		<rupture key="Tps_status">
			<before cond="$(Tps_status) ~= 'ok'">
				<font size="14"/>
				<lua>local status = $(Tps_status)</lua>
				<row h="0.4cm"/>
				<text row="auto" col="1" >ranking.Code(status)..' - '..ranking.Label(status)..' ('..body:GetCounterValue('Tps_status', status)..')'</text>
			</before>
		</rupture>
		


		<body>
			<row h="auto" />
			<row h="auto" />
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font name="calibri" size="9" adjust="ellipsize" />
			<spacing all="2" />
			<spacing left="7" right="10" top="2" bottom="2" />
			<col w="1cm"/>
			<text row_start="1" row_end="0" align="center" label="('Clt'..manche)" font_weight="bold" font_size_step="1"><background mode="solid" color="green" cond="group =='body' and (body:GetCell('Clt'..manche ,row)) == '1'" /><font color="white" cond="$(Clt) == '1'"/>body:GetCell('Clt'..manche ,row)</text>
			<col w="1cm"/>
			<text row_start="1" row_end="0" align="center" label="Dos.">$(Dossard)</text>
	
			<col w="5cm"/>
				<text row_start="1">''</text> 
				<background mode="transparent" />
				<text row_start="1" align="left" label="Identité  - Code coureur">$(Identite)</text> 
				<text row_start="1" align="right" >$(Code_coureur):sub(4)</text> 
				<background mode="solid" />
				<text row_start="2" align="left" label="Club - (CS.)">$(Club)..' - '..$(Comite{$(Comite)}.Nom):Parenthesis()</text> 
			<col w="2cm"/>
				<text row_start="1" align="center" label="Categ.(Cltc.)">$(Categ)..' - '..$(Cltc):Parenthesis()</text> 
				<text row_start="2" align="center" label="Sexe - An">$(Sexe)..' - '..$(An)</text> 
			<col w="0.5cm"/>
			<text row_start="1" row_end="0" border="1"></text>
				<matrix col_start="0" row_start="1" row_end="0">
					<row h="auto" />
					<row h="auto" />
					
					<lua>for m=1,Nb_tps_inter do;
							if tonumber(m) == 1 then
					</lua>	
								<col w="2cm" />
								<text row_start="1" row_end="0" col_start="1" align="right" label="Tps Ski(Clt)" ><background mode="solid" color="blue" cond="group =='body' and $(Clt1_inter1) == '1'" /><font color="white" cond="group =='body' and $(Clt1_inter1) == '1'"/>$(Tps1_inter1)..' '..$(Clt1_inter1):Parenthesis()</text>
								
					<lua>	
							else
							j = m-1
					</lua>
						<col w="3cm" />
						<text row_start="1" col_start="(m)" align="right" label="Ski + Materiel" ><background mode="solid" color="blue" cond="group =='body' and (body:GetCell('Clt'..manche..'_inter'..m ,row)) == '1'" /><font color="white" cond="group =='body' and (body:GetCell('Clt'..manche..'_inter'..m ,row)) == '1'"/>body:GetCell('Tps'..manche..'_inter'..m ,row)..' '..body:GetCell('Clt'..manche..'_inter'..m ,row):Parenthesis()</text> 
						<text row_start="2" col_start="(m)" align="left" label="Chagement materiel" ><background mode="solid" color="yellow" cond="group =='body' and (body:GetCell('Rank_Diff_I'..m..'_I'..m-1,row)) == '1'" />body:GetCell('Diff_I'..m..'_I'..m-1,row)..' '..body:GetCell('Rank_Diff_I'..m..'_I'..m-1,row):Parenthesis()</text>
						<lua>end
						end</lua>
						
					<col w="2.5cm" />
						<text row_start="1" col_start="(Nb_tps_inter+1)" align="right" label="('Tps'..manche)" ><background mode="solid" color="green" cond="group =='body' and (body:GetCell('Clt'..manche,row)) == '1'" /><font color="white" cond="group =='body' and (body:GetCell('Clt'..manche,row)) == '1'"/>body:GetCell('Tps'..manche,row)..' '..body:GetCell('Clt'..manche,row):Parenthesis()</text> 
						<text row_start="2" col_start="(Nb_tps_inter+1)" align="left" label="Tps Ski (Clt)" >body:GetCell(ColdiffTpsinterx,row)..'22 '..body:GetCell(ColRankTpsinterx,row):Parenthesis()</text> 
																														  
						<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
						
				</matrix>				
						
		</body>

	</report>

<!-- utilitaire permetant de faire un recap du nombre d'inscrit dans l'evenements -->
		<report id="uti_recapilatif" title="Nombre de participants" >
			<!-- header simplifier !-->
			<header>
				<spacing all="0"/>
				<background mode="transparent"/>
				<font name="Calibri" size="14" adjust="max" weight="bold"/>
				<text row="auto" col="1" align="center">$(Evenement.Nom)</text>
				<text row="auto" align="center" cond="title" >title</text>
				<row h="0.5cm"/>
			</header>
			<first_header />
			<!-- <background mode="transparent" /> -->
			<lua>
				entite = $(Evenement.Code_entite)
				body:SetCounter('Distance,Sexe,Categ', 'recap')
				body:SetCounter('Distance')
				body:SetCounter('Distance,Sexe', 'sex')
				counter = body:GetCounter('recap')
				counter1 = body:GetCounter('Distance')
				counter2 = body:GetCounter('sex')
			</lua>
			<order key="Distance, Sexe, Categ" />	
			<end>
				<!-- Par Distance -->
				<text row="auto" col_start="1" col_end="0" border="1" align="center" >'Récapitulatif par Distance'</text>
				<row h="0.3cm"/>
				<lua>for i=0, counter1:GetNbRows()-1 do </lua>
				<text row="auto" col_start="1" col_end="0">
					'distance '..counter1:GetCell(0,i)..' Km => '..counter1:GetCell('_count_',i)..'Inscrits'
				</text>
				<lua>sex = counter:GetCell(1,i)</lua> 
				<lua>dista = counter1:GetCell(0,i)</lua>
						<lua>for y=0, counter2:GetNbRows()-1 do </lua>
							<lua>if counter2:GetCell(0,y) == dista and counter2:GetCell(1,y) == 'F' then </lua>
								<lua>nbDamesT = counter2:GetCell('_count_',y)</lua>
									<text row="auto" col_start="1" col_end="0">
								'           Avec '..nbDamesT..' Dames'
								</text>
							
							<lua>elseif counter2:GetCell(0,y) == dista and counter2:GetCell(1,y) == 'M' then </lua>
								<lua>nbHommesT = counter2:GetCell('_count_',y)</lua>
							<text row="auto" col_start="1" col_end="0">
								'           Avec '..nbHommesT..' Hommes'
								</text>
							<lua>else </lua>
								
							<lua>end</lua>						
						<lua>end</lua>
					<row h="0.1cm"/>
				<lua>end</lua>
				<row h="1cm"/>
				
				<!-- Distance, Sexe, Categ -->
				<text row="auto" col_start="1" col_end="0" border="1" align="center">'Récapitulatif par Distance / sexe / Catégories'</text>
				<row h="0.3cm"/>
				<lua>for i=0, counter:GetNbRows()-1 do </lua>
					<lua>sexe = $(Sexe{counter:GetCell('Sexe',i)}.Libelle)</lua>
					<lua>categ = $(Categorie{counter:GetCell('Categ',i)}.Libelle)</lua>
					<lua>dist = counter:GetCell('Distance',i)</lua>
					<lua>nb = counter:GetCell('_count_',i)</lua>
						<matrix row="auto" col_start="1" col_end="0" >
							<call option="color_alternate" file="./edition/options.xml" />
							<!-- <col w="10, 0.2cm,5, 0.2cm,5, 0.2cm,5" /> -->
							<row h="auto" />
								<lua> if dist == counter:GetCell('Distance',i-1) then </lua>
									<text col_start="1" col="10" align="left" border ="0">''</text>
								<lua> else </lua>
									<text col_start="1" col="10" align="left" >'distance: '..dist..'Km'</text>
								<lua>
									end 
									if counter:GetCell('Sexe',i) == counter:GetCell('Sexe',i-1) then 
								</lua>
									<text col_start="2" col="10" align="left" border ="0" >''</text>
								<lua> else </lua>
									<text col_start="2" col="10" align="left">'Sexe: '..sexe</text>
								<lua> end </lua>
								
								<text col_start="3" col="10" align="left">'Catégorie: '..categ</text>
								
								<lua> if counter:GetCell('Sexe',i) == 'F' then </lua>
									<text col_start="4" col="10" align="left">'Inscrite(s): '..nb</text>
								<lua> else </lua>
									<text col_start="4" col="10" align="left">'Inscrit(s): '..nb</text>
								<lua> end </lua>
								<row h="0.2cm"/>
						</matrix>
					<row h="0.1cm"/>	
			<lua>end</lua>
			</end>
		</report>	

<!-- utilitaire permetant d' éditer les 3er de chaque épreuve -->				
		<report id="uti_podium" title="Podium par épreuve" >
			<!-- header simplifier !-->
			<header>
				<spacing all="0"/>
				<background mode="transparent"/>
				<font name="Calibri" size="14" adjust="max" weight="bold"/>
				<text row="auto" col="1" align="center">$(Evenement.Nom)</text>
				<text row="auto" align="center" >title</text>
				<row h="0.5cm"/>
			</header>
			<first_header />
			<order key="Tps, Dossard Desc" />
			
			<!-- <background mode="transparent" /> -->
			<lua>entite = $(Evenement.Code_entite)</lua>	
					<end>
						
						<lua>Liste_Epreuve = base:GetTable("Epreuve")</lua>
						<lua>for i=0, Liste_Epreuve:GetNbRows()-1 do</lua>
							<lua>catepr = $(Categorie{base:GetTable("Epreuve"):GetCell('Code_categorie',i)}.Libelle)</lua>
							<lua>codeepr = base:GetTable("Epreuve"):GetCell('Code_epreuve',i)</lua>
							<lua>sexepr = $(Sexe{base:GetTable("Epreuve"):GetCell('Sexe',i)}.Libelle)</lua>
							<lua>Distepr = base:GetTable("Epreuve"):GetCell('Distance',i)</lua>
							<text row="auto" col_start="1" col_end="0" border="1" align="center">'podium de epreuve : '..catepr..' // distance = '..Distepr..' Km '..sexepr</text>
							<row h="0.3cm"/>
							
								<matrix row="auto" col_start="1" col_end="0">
									<lua>steph = base:GetTable("body")</lua>
											<lua>for i=0, steph:GetNbRows()-1 do</lua>
												<lua>if steph:GetCell('Code_epreuve',i) == codeepr and steph:GetCell('Clte',i) == '1' then </lua>
												<matrix row="auto" col_start="1" col_end="0" >
													<row h="auto" />
													<text col_start="1" col="15" align="left">'1er : '..sexepr..': '..base:GetTable("body"):GetCell('Identite',i)</text>
													<text col_start="2" col="10" align="left">'Temps : '..base:GetTable("body"):GetCell('Tps',i)</text>
													<text col_start="3" col="10" align="left">'Club : '..base:GetTable("body"):GetCell('Club',i)</text>
													<text col_start="4" col="10" align="left">'Ville : '..base:GetTable("body"):GetCell('Ville',i)</text>
													</matrix>
												<lua>end</lua>
												<lua>if base:GetTable("body"):GetCell('Code_epreuve',i) == codeepr and base:GetTable("body"):GetCell('Clte',i) == '2' then </lua>
													<matrix row="auto" col_start="1" col_end="0" >
													<row h="auto" />
													<text col_start="1" col="15" align="left">'2ème : '..sexepr..': '..base:GetTable("body"):GetCell('Identite',i)</text>
													<text col_start="2" col="10" align="left">'Temps : '..base:GetTable("body"):GetCell('Tps',i)</text>
													<text col_start="3" col="10" align="left">'Club : '..base:GetTable("body"):GetCell('Club',i)</text>
													<text col_start="4" col="10" align="left">'Ville : '..base:GetTable("body"):GetCell('Ville',i)</text>
													</matrix>
												<lua>end</lua>
												<lua>if base:GetTable("body"):GetCell('Code_epreuve',i) == codeepr and base:GetTable("body"):GetCell('Clte',i) == '3' then </lua>
													<matrix row="auto" col_start="1" col_end="0" >
													<row h="auto" />
													<text col_start="1" col="15" align="left">'3ème : '..sexepr..': '..base:GetTable("body"):GetCell('Identite',i)</text>
													<text col_start="2" col="10" align="left">'Temps : '..base:GetTable("body"):GetCell('Tps',i)</text>
													<text col_start="3" col="10" align="left">'Club : '..base:GetTable("body"):GetCell('Club',i)</text>
													<text col_start="4" col="10" align="left">'Ville : '..base:GetTable("body"):GetCell('Ville',i)</text>
													</matrix>
												<lua>end</lua>
												
												
											<lua>end</lua>
											<row h="0.3cm"/>
								</matrix>
								
						<lua>end</lua>
			
					</end>
			
		</report>
	
<!-- Edition Relais-->
	<!-- Liste de départ relais-->
	<report id="Lst_Relais" header="1" first_header="(params.first_header or '1')" >
		<!-- <paper orientation="landscape" /> -->
		<lua>
			if $(Epreuve.Sexe) == 'F' then 		
				SexeEpreuve = 'Féminin';
			elseif $(Epreuve.Sexe) == 'M' then 		
				SexeEpreuve = 'Masculin';
			elseif $(Epreuve.Sexe) == 'T' then 		
				SexeEpreuve = 'Mixte';
			else
				SexeEpreuve = "";
			end
			
			if tonumber(params.Officiel) == 1 then
				title = "Liste de départ Officielle \n par équipe"
			elseif	tonumber(params.Officiel) == 0 then
				title = "Liste de départ Officieuse  \n par équipe"
			else
				title = "Liste de départ  \n par équipe "
			end
		</lua>
		<order key="Dossard"/>	
		<lua>
			bodyrelais = body:Copy(false);
			for i=0, body:GetNbRows()-1 do
				CodeCoureur = body:GetCell('Code_coureur', i):sub(1,3);
				if CodeCoureur == 'EQU' then
					bodyrelais:AddRow();
					sqlTable.CopyRow(bodyrelais, bodyrelais:GetNbRows()-1, body, i);
				end
			end
			body = bodyrelais;
	
			_context_border = true;
			
			entite = $(Evenement.Code_entite);
			discipline = $(Epreuve.Code_discipline);
			body:SetCounter('Code_epreuve');
			NbEquipiers = tonumber($(Epreuve_Nordique.Equipe)) or 2;
		</lua>
		
		<label>
			<col w="2,8,4,6cm,1.6cm,3cm,1.5cm,3"/>
			<row h="auto" />
			<text col_start="1" col_end="3"  align="center"><background mode="solid" color="green" />'Equipe'</text>
			<text col_start="4" col_end="7"  align="center"><background mode="solid" color="yellow" />'Relayeurs'</text>
			<!-- <text col_start="8" col_end="0"  align="center"><background mode="solid" color="green" /></text> -->
			<row h="auto" />
			<pen border="all" size="1" />
			<text col_start="1" align="center">'Dos'</text>
			<text col_start="2" align="center">'Nom - Equipe'</text>
			<text col_start="3" align="center">'Sexe'</text>
			<text col_start="4" align="left">'Dos - Identité'</text>
			<text col_start="5" align="center">'Categ.(S.)'</text>
			<text col_start="6" align="center">'Club (CS.)'</text>
			<text col_start="7" align="center">'Pts'</text>
			<text col_start="8" align="center">'Pts.Equ.'</text>
			<row h="0.4cm"/>
		</label>
		
		<body>
			<lua>
				CodeInscrit = $(Code_coureur)
				TableResultatAdresse = base:GetTable('Resultat_Adresse')
				cmd = "Select * From Resultat_Adresse Where Code_evenement = "..$(Evenement.Code)..
							  " and Code_coureur = '"..$(Code_coureur).."'"

						CodePostal = base:TableLoad(TableResultatAdresse, cmd):GetCell('Code_postal', 0):sub(1,2)
						Ville = base:TableLoad(TableResultatAdresse, cmd):GetCell('Ville', 0)
			</lua>
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font size="9" adjust="ellipsize"/>
			<spacing left="10" right="10" top="2" bottom="2" />
			
			<lua>for n=0,tonumber(NbEquipiers)-1 do</lua>
			<row h="0.5cm"/>
			<lua>end</lua>
			<col w="2,8,4,6cm,1.6cm,3cm,1.5cm,3" />
			<text row_start="1" row_end="0" col_start="1" align="right" >$(Dossard)</text>
			<text row_start="1" row_end="0" col_start="2" align="left" >$(Identite)</text> 
			<lua>
				if $(Sexe) == 'F' then 		
					SexeEquipe = 'Féminine';
				elseif $(Sexe) == 'M' then 		
					SexeEquipe = 'Masculine';
				elseif $(Sexe) == 'T' then 		
					SexeEquipe = 'Mixte';
				end
			</lua>
			<text row_start="1" row_end="0" col_start="3" align="center" >SexeEquipe</text>
			<lua>
				TableResultatEquipe = base:GetTable('Resultat_Equipe')
						cmd = "Select * From Resultat_Equipe Where Code_evenement = "..$(Evenement.Code)..
							  " and Code_coureur = '"..$(Code_coureur)..
							  "' Order By Numero"
					NbEquipiers1 = base:TableLoad(TableResultatEquipe, cmd):GetNbRows();
					
					for m=0, NbEquipiers-1 do
						IdentiteEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Nom', m);
						SexeEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Sexe', m);
						CategEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Categ', m);
						ClubEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Club', m);
						CsEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Comite', m);
						PointEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Point', m);
						if params.DossardRelais == 'Lettre' then
							LettreDossard = $(Dossard)..'-'..base:TableLoad(TableResultatEquipe, cmd):GetCell('Numero', m);
						else
							LettreDossard = $(Dossard)..'/'..m+1;
						end
			</lua>
			<text row_start='(m+1)' col_start="4" align="left" >LettreDossard..' - '..IdentiteEquipier</text>
			<text row_start='(m+1)' col_start="5" align="center" >CategEquipier..''..SexeEquipier:Parenthesis()</text>
			<text row_start='(m+1)' col_start="6" align="center" >ClubEquipier..''..CsEquipier:Parenthesis()</text>
			<text row_start='(m+1)' col_start="7" align="center" >PointEquipier</text>
			<lua>end</lua>  
			<text row_start="1" row_end="0" col_start="8" align="right" >$(Point)</text>
			<row h="0.6cm"/>
		</body>
	</report>	

	<!-- Resultat de relais-->
	<report id="res_Relais" title="Résultats Relais " header="1" first_header="(params.first_header or '1')">
		<lua>
			if $(Epreuve.Sexe) == 'F' then 		
				SexeEpreuve = 'Féminin';
			elseif $(Epreuve.Sexe) == 'M' then 		
				SexeEpreuve = 'Masculin';
			elseif $(Epreuve.Sexe) == 'T' then 		
				SexeEpreuve = 'Mixte';
			else
				SexeEpreuve = "";
			end
			if tonumber(params.Officiel) == 1 then
				title = "Résultats Officiels "
			elseif	tonumber(params.Officiel) == 0 then
				title = "Résultats Officieux "
			else
				title = "Résultats Provisoires "
			end
		</lua>
		<column name="Tps_status">chrono.Status(body:GetCellInt('Tps', row))</column>
		<rupture key="Tps_status">
			<before cond="$(Tps_status) ~= 'ok'">
				<font size="14"/>
				<lua>local status = $(Tps_status)</lua>
				<row h="0.5cm"/>
				<text row="auto" col="1" >ranking.Code(status)..' - '..ranking.Label(status)..' ('..body:GetCounterValue('Tps_status', status)..')'</text>
				<row h="0.2cm"/>
			</before>
		</rupture>
		<!-- <paper orientation="landscape" /> -->
		<lua>
			bodyrelais = body:Copy(false);
			for i=0, body:GetNbRows()-1 do
				CodeCoureur = body:GetCell('Code_coureur', i):sub(1,3);
				if CodeCoureur == 'EQU' then
					bodyrelais:AddRow();
					sqlTable.CopyRow(bodyrelais, bodyrelais:GetNbRows()-1, body, i);
				end
			end
			body = bodyrelais;
			_context_border = true;
			entite = $(Evenement.Code_entite);
			discipline = $(Epreuve.Code_discipline);
			body:SetCounter('Code_epreuve');
			NbEquipiers = tonumber($(Epreuve_Nordique.Equipe)) or 2;
		</lua>
		<order key="Tps, Dossard Desc" />
		
		<label>
			<row h="auto" />
			<row h="auto" />
			<row h="auto" />
			<pen border="all" size="1" />
			<text row_start="1" row_end="1" col="3" align="center" border="none" >'Clt'</text>
			<text row_start="1" row_end="1" col="2" align="center" border="none" >'Dos'</text>
			<text row_start="1" row_end="1" col="10" align="center" border="none" >'Nom - Equipe'</text>
			<text row_start="1" row_end="1" col="4" align="center" border="none" >'S. Relais'</text>
			<col w="1,1,1,1,1,1,1,1,1,1"/>
			
			<text row_start="2" row_end="2" col_start="2" col_end="9" align="center"><background mode="solid" color="yellow" />'Relayeurs'</text>
			<text row_start="3" row_end="3" col_start="2" col_end="4" align="left">'Dos - Code   Identité        (Sexe)'</text>
			<text row_start="3" row_end="3" col_start="5" col_end="7" align="center"><font size="9" adjust="ellipsize"/>'Tps.'</text>
			<text row_start="3" row_end="3" col_start="8" col_end="9" align="center">'Clt. '</text>
			<text row_start="3" row_end="3" col_start="10" col_end="13" align="center">'Tps. Relais'</text>
			<text row_start="1" row_end="1" col="2" align="center" border="none" >'CS.'</text>
			<text row_start="1" row_end="1" col="5" align="right" border="none" >'Tps. Rel.'</text>
			<text row_start="1" row_end="1" col="4" align="right" border="none" >'Ecart. Rel.'</text>
			<row h="0.4cm"/>
		</label>
		
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font size="9" adjust="ellipsize"/>
			<spacing left="10" right="10" top="2" bottom="2" />

			<row h="0.6cm"/>
			<lua>for n=0,tonumber(NbEquipiers)-1 do</lua>
			<row h="0.5cm"/>
			<lua>end</lua>
			<col w="3"/>
			<text row_start="1" row_end="1" align="center" border="none" >$(Clt)</text>
			<col w="2"/>
			<text row_start="1" row_end="1" align="right" border="none" >$(Dossard)</text>
			<col w="10"/>
			<text row_start="1" row_end="1" align="left" border="none">$(Identite)</text> 
			<col w="4"/>
				<lua>
					if $(Sexe) == 'F' then 		
						SexeEquipe = 'Féminine';
					elseif $(Sexe) == 'M' then 		
						SexeEquipe = 'Masculine';
					elseif $(Sexe) == 'T' then 		
						SexeEquipe = 'Mixte';
					end
				</lua>
			<text row_start="1" row_end="1" align="center" border="none" >SexeEquipe</text>
			
			
				<col w="1,1,1,1,1,1,1,1,1,1"/>
				<text row_start="1" row_end="1" col_start="4" col_end="14" align="center" border="none" >''</text>
				<lua>
					dofile('./interface/adv.lua');
					tempsrelayeur1Ms = 0;
					tempsrelayeur2Ms = 0;
					tempsRelay = 0;
					TableResultatEquipe = base:GetTable('Resultat_Equipe')
						cmd = "Select * From Resultat_Equipe Where Code_evenement = "..$(Evenement.Code)..
							  " and Code_coureur = '"..$(Code_coureur)..
							  "' Order By Numero"
					NbEquipiers1 = base:TableLoad(TableResultatEquipe, cmd):GetNbRows();
					
					for m=0, NbEquipiers-1 do
						IdentiteEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Nom', m);
						MatricEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Matric', m);
						SexeEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Sexe', m);
						CategEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Categ', m);
						PointEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Point', m);
						TpsEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Tps_chrono', m, "%-1h%-1m%2s.%1f");
						TpsrelayeurMs = adv.HHMMSSms_To_MS(base:TableLoad(TableResultatEquipe, cmd):GetCell('Tps_chrono', m, "%2h:%2m:%2s.%3f"));
						
							cmd1 = "Select * From Resultat_Equipe Where Code_evenement = "..$(Evenement.Code)..
							  " and Numero = '"..base:TableLoad(TableResultatEquipe, cmd):GetCell('Numero', m)..
							  "' Order By Tps_chrono"
							for i=0, base:TableLoad(TableResultatEquipe, cmd1):GetNbRows()-1 do 
								if base:TableLoad(TableResultatEquipe, cmd1):GetCell('Matric', i) == MatricEquipier then
									CltEquipier = i+1;
								end
							end
						tempsRelay = tempsRelay + TpsrelayeurMs;
						tempsRelayForm = app.TimeToString(tempsRelay, "%-1h%-1m%2s.%1f");
						
						
						if params.DossardRelais == 'Lettre' then
							LettreDossard = $(Dossard)..'-'..base:TableLoad(TableResultatEquipe, cmd):GetCell('Numero', m);
						else
							LettreDossard = $(Dossard)..'-'..m+1;
						end
				</lua>
						
				<text row_start='(m+2)' col_start="2" col_end="4" align="left" label="('Identité Relayeur '..m+1)">LettreDossard..' - '..MatricEquipier..'  '..IdentiteEquipier..''..SexeEquipier:Parenthesis()</text>
				<text row_start='(m+2)' col_start="5" col_end="7" align="right" label="('Tps Relayeur '..m+1)" >TpsEquipier</text>
				<text row_start='(m+2)' col_start="8" col_end="9" align="right" label="('Clt Rel'..m+1)" >CltEquipier</text>
				<text row_start='(m+2)' col_start="10" col_end="13" align="right" >tempsRelayForm</text>
				
				
					<lua>end</lua>
			<col w="2"/>
			<!-- <text row_start="1" row_end="1" align="center" label="CS." border="none" >$(Comite)</text> -->
			<text row_start="1" row_end="1" align="center" label="CS." border="none" >$(Club)</text>
			<col w="5"/>
			<text row_start="1" row_end="1" align="right" label="Tps. Equipe" border="none" >$(Tps)</text>
			<col w="4"/>
			<text row_start="1" row_end="1" align="right" label="Ecart. Equipe" border="none" >$(Diff)</text>
			<row h="0.6cm"/>
		</body>
		
		<end cond="tonumber(params.Officiel)==1">
			<lua>sqlBase.FixationTableRanking(body)</lua>
			<call option="signature_dt" file="./edition/options.xml" />
		</end>
	</report>
	
	<!-- Tableau de services -->
	<report id="Tab_services" title="(params.title or '')" header="1" first_header="0" rupture="0">
		<lua>
			local tOfficiel = base:GetTable('Evenement_Officiel')
			tOfficielRequired = tOfficiel:Copy(false);
			for i=0, tOfficiel:GetNbRows()-1 do
					tOfficielRequired:AddRow();
					sqlTable.CopyRow(tOfficielRequired, tOfficielRequired:GetNbRows()-1, tOfficiel, i)
			end
			body = tOfficielRequired;
		</lua>
		<order key="Ordre Asc" />
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font size="14" adjust="ellipsize"/>
			<row h="70px"/>
			<spacing left="5" right="10" top="2" bottom="2" />
			<text col="26" align="left" label="Fonction">base:GetOfficielAttribute($(Fonction), 'label')</text>
			<text col="12" align="left" label="Nom">$(Nom):upper()</text>
			<text col="12" align="left" label="Prénom">$(Prenom):sub(1,1):upper()..$(Prenom):sub(2):lower()</text> 
			<text col="4" align="center" label="Nat" cond="entite == 'FIS'">$(Nation)</text>
			<text col="4" align="center" label="CS." cond="entite == 'FFS'">$(Nation)</text>
			<text col="30" align="left" label="Commentaire.">$(Info_supplement)</text>
			
			<!-- <text col="12" align="left" label="Club" cond="entite == 'FFS'">$(Club)</text> -->
			<!-- <text col="6" align="right" label="Points" cond="entite == 'FFS'">$(Point)</text> -->
			<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
		</body>
	</report>
	
	<!-- Resultat deq temps des tours inter  -->
	<report id="res_Tour" title="Résultats Relais " header="1" first_header="0">
		<paper orientation="landscape" />
		<lua>
			bodyrelais = body:Copy(false);
			for i=0, body:GetNbRows()-1 do
				CodeCoureur = body:GetCell('Code_coureur', i):sub(1,3);
				if CodeCoureur == 'EQU' then
					bodyrelais:AddRow();
					sqlTable.CopyRow(bodyrelais, bodyrelais:GetNbRows()-1, body, i);
				end
			end
			body = bodyrelais;
			_context_border = true;
			entite = $(Evenement.Code_entite);
			discipline = $(Epreuve.Code_discipline);
			body:SetCounter('Code_epreuve');
			NbEquipiers = tonumber($(Epreuve_Nordique.Equipe)) or 2;
		</lua>
		<order key="Tps" />
		
		<label>
			<pen border="all" size="1" />
			<font size="9" adjust="ellipsize"/>
			<spacing left="10" right="10" top="2" bottom="2" />
			<row h="auto" />
			<text col="3" align="center" border="none" >'Clt'</text>
			<text col="2" align="center" border="none" >'Dos'</text>
			<text col="10" align="center" border="none" >'Nom - Prénom'</text>
			<text col="4" align="center" border="none" >'S.'</text>
			<text col="6" align="center" border="none" >'Tps.'</text>
			<matrix row="0.4cm" col_start="1" col_end="0" >
			<font size="9" adjust="ellipsize"/>
			<spacing left="10" right="10" top="2" bottom="2" />
			<lua>for n=0,tonumber(NbEquipiers)-1 do
				j = n+1
			</lua>
			<text col="4.4cm" align="center"><background mode="solid" color="yellow" />'Tps tour'..j..'// Tps-Cumul'</text>
			<lua>end</lua>	
			</matrix>
			<row h="0.4cm"/>
		</label>
		
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font size="9" adjust="ellipsize"/>
			<spacing left="10" right="10" top="2" bottom="2" />
			<row h="0.5cm"/>
			<text col="3" align="center" border="none" >$(Clt)</text>
			<text col="2" align="right" border="none" >$(Dossard)</text>
			<text col="10" align="left" border="none">$(Identite)</text> 
				<lua>
					if $(Sexe) == 'F' then 		
						SexeEquipe = 'Féminine';
					elseif $(Sexe) == 'M' then 		
						SexeEquipe = 'Masculine';
					elseif $(Sexe) == 'T' then 		
						SexeEquipe = 'Mixte';
					end
				</lua>
			<text col="4" align="center" border="none" >SexeEquipe</text>
			<text col="6" align="center" border="none" >$(Tps)</text>
			
			<matrix row="0.4cm" col_start="1" col_end="0" >
			<font size="9" adjust="ellipsize"/>
			<spacing left="10" right="10" top="2" bottom="2" />
				<row h="0.4cm"/>
					<lua>
						dofile('./interface/adv.lua');
						tempsrelayeur1Ms = 0;
						tempsrelayeur2Ms = 0;
						tempsRelay = 0;
						TableResultatEquipe = base:GetTable('Resultat_Equipe')
							cmd = "Select * From Resultat_Equipe Where Code_evenement = "..$(Evenement.Code)..
								  " and Code_coureur = '"..$(Code_coureur)..
								  "' Order By Numero"
						NbEquipiers1 = base:TableLoad(TableResultatEquipe, cmd):GetNbRows();
						
						for m=0, NbEquipiers-1 do
							TpsEquipier = base:TableLoad(TableResultatEquipe, cmd):GetCell('Tps_chrono', m, "%-1h%-1m%2s.%1f");
							TpsrelayeurMs = adv.HHMMSSms_To_MS(base:TableLoad(TableResultatEquipe, cmd):GetCell('Tps_chrono', m, "%2h:%2m:%2s.%3f"));
							
								cmd1 = "Select * From Resultat_Equipe Where Code_evenement = "..$(Evenement.Code)..
								  " and Numero = '"..base:TableLoad(TableResultatEquipe, cmd):GetCell('Numero', m)..
								  "' Order By Tps_chrono"
								for i=0, base:TableLoad(TableResultatEquipe, cmd1):GetNbRows()-1 do 
									if base:TableLoad(TableResultatEquipe, cmd1):GetCell('Matric', i) == MatricEquipier then
										CltEquipier = i+1;
									end
								end
							tempsRelay = tempsRelay + TpsrelayeurMs;
							tempsRelayForm = app.TimeToString(tempsRelay, "%-1h%-1m%2s.%1f");
							
							
							if params.DossardRelais == 'Lettre' then
								LettreDossard = $(Dossard)..'-'..base:TableLoad(TableResultatEquipe, cmd):GetCell('Numero', m);
							else
								LettreDossard = $(Dossard)..'-'..m+1;
							end
					</lua>

						<text col="1.7cm" align="right" >TpsEquipier</text>
						<text col="1cm" align="right" >CltEquipier</text>
						<text col="1.7cm" align="right" >tempsRelayForm</text>
					<lua>end</lua>	
				<row h="0.4cm"/>
				</matrix>
		</body>
	</report>
	
	<!-- Edition des Séquences Chrono -->
	<report id="chrono_seq" title="('Edition des Séquences de Chronométrage Manche n°'..manche)" first_header="0">
		<order key="Seq" />

		<body>
			<call option="couleur_alternee" file="./edition/options.xml"/>

			<lua>origine = 'Départ'</lua>
			<lua>if group == 'body' then</lua>
				<lua>if body:GetCellInt('Id', row) == -1 then origine = 'Arrivée'</lua>
				<lua>elseif body:GetCellInt('Id', row) &gt;= 1 then origine = 'Inter '..$(Id)</lua>
				<lua>end</lua>
			<lua>end</lua>

			<row value="auto"/>
			<text col="5" align="right" label="Seq" font_weight="bold" font_size_step="1">$(Seq)</text>
			<text col="8" align="center" label="Origine">origine</text>
			<text col="12" align="center" label="Heure" font_weight="bold" font_size_step="1">$(Heure)</text>
			<text col="7" align="right" label="Dossard" font_weight="bold" font_size_step="1">$(Dossard)</text>
			<text col="15" align="center" label="Périphérique">$(Device)</text>
			<text col="7" align="center" label="Anc.Dos.">$(Dossard_anc)</text>
		</body>
	</report>
	
	<report id="lst_FIS" title="(params.title or '')" header="1" first_header="(params.first_header or '1')" >
		<call option="identiteCoureur" file="./edition/options.xml"/>
		<lua>
			entite = $(Evenement.Code_entite)
			discipline = $(Epreuve.Code_discipline)
			type_edition = id:sub(1,4)
			officiel = tonumber(params.officiel)
			Regroupement = $(Epreuve.Code_regroupement)
		</lua>	
		<order key="Heure_depart1, Dossard, Identite" />
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<call option="identite" file="./edition/options.xml"/>
			<font size="9" adjust="ellipsize"/>
			<spacing left="5" right="10" top="2" bottom="2" />
			<lua>
				LabelCode = $(Code_coureur):sub(1,3)
			</lua>
			<row h="auto"/>
			<text col="0.5cm" font_size="6" align="center" label="Pb">$(Modif_manuel) </text>
			<text col="4" align="right" label="Dos">$(Dossard) </text>
			<text col="7" align="center" label="Code"><font size="8" cond="group =='body'"/>$(Code_coureur):sub(4)</text>  
			<text col="18" align="left" label="Prénom - Nom" >GetIdentiteCoureur(officiel)</text> 
			<text col="4" align="center" label="An">$(An)</text>
			<text col="6" align="center" label="Categ">$(Categ)</text>
			<text col="4" align="center" label="S.">$(Sexe)</text>
			<text col="4" align="center" label="Dist.">$(Distance)</text>
			<text col="4" align="center" label="Nat" cond="entite == 'FIS'">$(Nation)</text>
			<text col="4" align="center" label="CS." cond="entite == 'FIS'">$(Comite)</text>
			<text col="12" align="left" label="Club" cond="entite == 'FIS'">$(Club)</text>
			<text col="6" align="right" label="Pts-FIS" cond="entite == 'FIS'">$(Point)</text>
			<text col="6" align="right" label="Pts-FFS" cond="entite == 'FFS'">$(Point)</text>
			<text col="6" align="right" label="Pts-FFS" >$(Pts_best)</text>
			<text col="6" align="right" label="Pts-Dst" cond="discipline ~= 'KO-QLF'" >$(PtsClt)</text>
			<text col="6" align="right" label="Pts-Spr" cond="discipline == 'KO-QLF'" >$(PtsClt)</text>
			<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
		</body>
	</report>
	
	<!-- Liste de depart par nation et club	 -->
	<report id="part_NatClub" title="(params.title or '')" header="1" first_header="(params.first_header or '1')" >
		<lua>
			page_break = page_break or 1;
			officiel = tonumber(params.officiel or 0);
			
			entite = $(Evenement.Code_entite);
			lang = lang or 'fr';

			body:SetCounter('Nation');
			body:SetCounter('Comite');
		</lua>
		<order key="Nation,Comite,Rang,Dossard,Identite" />
		<call option="identiteCoureur" file="./edition/options.xml"/>
		<call option="traduction" file="./edition/options.xml"/>
		
		<rupture key="Nation">
			<before>
				<lua>
					nation = body:GetCell('Nation', row);
					local comite = body:GetCell('Comite', row)
				</lua>
			<pagebreak cond="page_break == 1 and row ~= 0 and comite == '' " />
				
				<row h="0.2cm"/>
				<text row="auto" col="1" align="left" ><font size="14"/>$(Nation{nation}.Libelle)..' ('..body:GetCounterValue('Nation', nation)..')'</text>
			</before>
		</rupture>

		<rupture key="Comite">
			<before>
				<lua>
					local comite = body:GetCell('Comite', row)
				</lua>
				<pagebreak cond="row ~= 0" />
				<font size="12"/>
				<row h="0.4cm"/>
				<!-- <lua>comite = body:GetCell('Comite', row)</lua> -->
				<text row="auto" col="1" >comite..'. '..$(Comite{comite}.Nom)..' ('..body:GetCounterValue('Comite', comite)..')'</text>
			</before>
		</rupture>

		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<font size="9" adjust="ellipsize"/>
			<spacing left="5" right="10" top="2" bottom="2" />
			<pen border="none" />
			<row h="auto"/>
			<!-- <text col="0.5cm" font_size="6" align="center" label="Pb">$(Modif_manuel) </text> -->
			<!-- <text col="4" align="right" label="(traduction('Dos'))">$(Dossard) </text> -->
			<text col="7" align="center" label="(traduction('Code'))" ><font size="8" cond="group =='body'"/>$(Code_coureur):sub(4)</text>
			<text col="18" align="left" label="(traduction('Identité'))">GetIdentiteCoureur(officiel)</text> 
			<text col="4" align="center" label="(traduction('An'))">$(An)</text>
			<text col="6" align="center" label="(traduction('Categ'))">$(Categ)</text>
			<text col="4" align="center" label="(traduction('S.'))">$(Sexe)</text>
			<text col="4" align="center" label="(traduction('Nat'))" cond="entite == 'FIS'">$(Nation)</text>
			<text col="4" align="center" label="(traduction('CS.'))" cond="entite == 'FFS'">$(Comite)</text>
			<text col="12" align="left" label="(traduction('Club'))" cond="entite == 'FIS'">$(Club)</text>
			<text col="6" align="right" label="(traduction('Points'))" cond="entite == 'FFS'">$(Point)</text>
			<text col="6" align="right" label="Pts FIS" cond="entite == 'FFS'">$(Pts_best)</text>
			<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
		</body>
	</report>
	
	<!-- Résultats Multi-Passage -->
	<report id="res_inter_Multi_Lap" title="Résultats Inter Multi-Passages" first_header="0">
		<column name="Tps_status">chrono.Status(body:GetCellInt('Tps', row))</column>
		<!-- création des colonne dans le body -->
		<!-- app.GetAuiMessage():AddLine(ColTpsInterX); -->
		<column name="Diff_Inter_Lap" type="chrono" />
		<column name="Rank_Diff_Inter_Lap" type="ranking" />
		<column name="Diff_Tps_Inter" type="chrono" />
		<column name="Rank_Diff_Tps_Inter" type="ranking" />
		<lua>
			code_epreuve = $(Epreuve.Code_epreuve) or 1
			code_manche = manche or 1
			tPassage = base:GetTable('Epreuve_Passage')
			cmd = "Select * from Epreuve_Passage Where Code_evenement = "..$(Evenement.Code)..
				" And Code_epreuve = "..code_epreuve..
				" And Code_manche = "..code_manche
			base:TableLoad(tPassage, cmd)
			if tPassage:GetNbRows()~= nil then
				if tPassage:GetNbRows() == 1 then 
					code_passage = tPassage:GetCellInt('Code_Passage', 0)
					nb_lap = tonumber(tPassage:GetCellInt('Nb_Lap', 0))
				end
			else
				code_passage = 1
				nb_lap = 10
			end
			if tonumber(params.Cumul) == 1 then
				cumul = "_cumul"
				Label_lap = 'Lap'
			else
				cumul = ""
				Label_lap = 'Tour'
				ColTpsX = 'Tps'..code_manche
				ColTpsInterX = 'Tps'..code_manche..'_inter'..code_passage
				ColdiffTpsinterx = 'Diff_Inter_Lap'
				ColRankTpsinterx = 'Rank_Diff_Inter_Lap'
				ColrefOrderX = 'Diff_Inter_Lap, Dossard Desc'
				ColTpsInterXLapY =  'Tps_cumul'..code_manche..'_inter'..code_passage..'_lap'..nb_lap-1
				body:ComputeSubtractTime(ColdiffTpsinterx, ColTpsX, ColTpsInterX)
				body:SetRanking(ColRankTpsinterx, ColrefOrderX)
				if nb_lap == 1 then
					ColLapInterY = 'Tps'..code_manche..'_inter'..code_passage
					Rank_LapInterY = 'Clt'..code_manche..'_inter'..code_passage 
				else
					ColLapInterY = 'Diff_Tps_Inter'
					Rank_LapInterY = 'Rank_Diff_Tps_Inter'
					ColrefOrderY = 'Diff_Tps_Inter, Dossard Desc'
					body:ComputeSubtractTime(ColLapInterY, ColTpsInterX, ColTpsInterXLapY)
					body:SetRanking(Rank_LapInterY, ColrefOrderY)
				end
			end
		</lua>
		<order key="Tps, Dossard" />
		<rupture key="Tps_status">
			<before cond="$(Tps_status) ~= 'ok'">
				<font size="14"/>
				<lua>local status = $(Tps_status)</lua>
				<row h="0.5cm"/>
				<text row="auto" col="1" >ranking.Code(status)..' - '..ranking.Label(status)..' ('..body:GetCounterValue('Tps_status', status)..')'</text>
				<row h="0.2cm"/>
			</before>
		</rupture>
		<body>
			<call option="couleur_alternee" file="./edition/options.xml" />
			<font size="9" adjust="ellipsize"/>
	
			<row value="auto"/>
			<text col="4" align="right" label="Dos.">$(Dossard)</text>
			<text col="12" align="left" label="Nom - Prénom" font_weight="bold" font_size_step="1">$(Identite)</text> 
			<text col="4" align="center" label="Cat.">$(Categ)</text>
			
			<lua>
				if nb_lap > 0 then
					for l=1,nb_lap-1 do
			</lua>
					<text col="8" cond="group=='label'" label="('Inter'..code_passage..' '..Label_lap..'. '..l)"/>
					<matrix col="8" cond="group=='body'" fit_inside="0" >
						<row h="1"/>
						<font size_step="-1" />
						<!-- <text col="7" align="right">body:GetCell('Tps'..manche..'_inter'..manche..'_lap'..l,row)</text> -->
						<text col="7" align="right">body:GetCell('Tps'..cumul..''..code_manche..'_inter'..code_passage..'_lap'..l, row, '[P10]%-1h%-1m%2s.%2f')</text>
						<text col="7" align="right">body:GetCell('Clt'..cumul..''..code_manche..'_inter'..code_passage..'_lap'..l, row)</text>
					</matrix> 
				<lua>end</lua>
					<text col="8" cond="group=='label'" label="('Inter'..code_passage..' '..Label_lap..'. '..nb_lap)"/>
					<matrix col="8" cond="group=='body'" fit_inside="0" >
						<row h="1"/>
						<font size_step="-1" />
						<lua>if tonumber(params.Cumul) == 1 then</lua>
							<text col="7" align="right">body:GetCell('Tps'..manche..'_inter'..code_passage, row, '[P10]%-1h%-1m%2s.%2f')</text>
							<text col="4" align="right">body:GetCell('Clt'..manche..'_inter'..code_passage, row)</text>
						<lua>else</lua>
							<text col="7" align="right">body:GetCell(ColLapInterY, row, '[P10]%-1h%-1m%2s.%2f')</text>
							<text col="4" align="right">body:GetCell(Rank_LapInterY, row)</text>
						<lua>end</lua>					
					</matrix>
				<lua>if tonumber(params.Cumul) == 0 then</lua>
						<text col="8" cond="group=='label'" label="('Inter'..code_passage..' '..Label_lap..'. '..nb_lap+1)"/>
						<matrix col="8" cond="group=='body'" fit_inside="0" >
							<text col="7" align="right">body:GetCell(ColdiffTpsinterx, row, '[P10]%-1h%-1m%2s.%2f')</text>
							<text col="4" align="right">body:GetCell(ColRankTpsinterx, row)</text>
							<!-- <text col="4" align="right">body:GetCell(ColTpsX, row)</text> -->
						</matrix> 
				<lua>end</lua>
			<lua>end</lua>

			<text col="10" cond="group=='label'" label="Tps Total"/>
			<matrix col="10" cond="group=='body'" fit_inside="0" >
				<row h="1"/>
				<font size_step="1" weight="bold" />
				<text col="7" align="right">$(Tps)..$(Clt):Parenthesis()</text>
				<text col="5" align="right">$(Diff)</text>
			</matrix>
		</body>
	</report>
	
<!-- Edition UNSS	 -->
<!-- Liste Par Ordre Equipe -->
	<report id="part_UNSS" title="(params.title or '')" header="1" first_header="0" rupture="0">
		<call option="identiteCoureur" file="./edition/options.xml"/>
		<order key="Equipe, Groupe, Dossard Asc" />
		<rupture key="Equipe" >
			<before>
				<font size="14"/>
				<row h="0.4cm"/>
				<text row="auto" col="1" >'Equipe: '..$(Equipe)..'-'..$(Centre)..' -> '..$(Club)</text>
				<!-- <text row="auto" col="1" >$(Equipe)..'-'..$(Centre)..' -> '..$(Critere)</text> -->
			</before>
		</rupture>
		
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<font size="9" adjust="ellipsize"/>
			<pen border="none" />
			<row h="auto"/>
			<spacing left="5" right="10" top="2" bottom="2" />
			<text col="4" align="right" label="Dos">$(Dossard) </text>
			<!-- <text col="7" align="center" label="Code"><font size="8" cond="group =='body'"/>$(Code_coureur):sub(4)</text> -->
			<text col="20" align="left" label="Nom - Prénom">GetIdentiteCoureur(officiel)</text> 
			<text col="4" align="center" label="An">$(An)</text>
			<text col="6" align="center" label="Categ">$(Categ)</text>
			<!-- <text col="4" align="center" label="S.">$(Sexe)</text> -->
			<!-- <text col="4" align="center" label="Dist.">$(Distance)</text> -->
			<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
		</body>
	</report>
	
<!-- Résultats Equipe X Best_Time-->
	<report id="res_Tps_Equipe" title="(params.title or '')" header="1" first_header="0" rupture="0">
		<call option="identiteCoureur" file="./edition/options.xml"/>

		<order key="Clt, Critere, Dossard Asc" />
		<rupture key="Equipe" >
			<before>
				<font size="14"/>
				<row h="0.4cm"/>
				<text row="auto" col="1" >'Clt: '..$(Clt)..'  Equipe N°:'..$(Equipe)..' Du '..$(Club)..'  Tps Equipe -> '..$(Tps_best)</text>
			</before>
		</rupture>
		
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<font size="9" adjust="ellipsize"/>
			<pen border="none" />
			<row h="auto"/>
			<spacing left="5" right="10" top="2" bottom="2" />
			<!-- <text col="4" align="right" label="Dos">$(Clt)</text> -->
			<text col="4" align="right" label="Dos">$(Dossard)</text>
			<!-- <text col="7" align="center" label="Code"><font size="8" cond="group =='body'"/>$(Code_coureur):sub(4)</text> -->
			<text col="20" align="left" label="Nom - Prénom">GetIdentiteCoureur(officiel)</text> 
			<text col="4" align="center" label="An">$(An)</text>
			<text col="6" align="center" label="Categ">$(Categ)</text>
			<text col="4" align="center" label="S.">$(Sexe)</text>
			<text col="4" align="center" label="Dist.">$(Distance)</text>
			<text col="7" align="center" label="Tps.">$(Tps)..$(Clt):Parenthesis()</text>
			<text col="4" align="center" label="Dist.">$(Tps_best)</text>
			<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
		</body>
	</report>	

<!-- Résultats Equipe Patrouille (derniers temps)-->	
	<report id="res_Tps_Patrouille" title="(params.title or '')" header="1" first_header="0" rupture="0">
		<call option="identiteCoureur" file="./edition/options.xml"/>
		<!-- <order key="Centre Clt, Critere, Dossard Asc" /> -->
		<rupture key="Equipe" >
			<before>
				<font size="14"/>
				<row h="0.4cm"/>
				<text row="auto" col="1" >'Clt: '..$(Clt)..'  Equipe N°:'..$(Equipe)..' Du '..$(Club)..'  Tps Equipe -> '..$(Tps_best)</text>
				<!-- <text row="auto" col="1" >'Clt: '..$(Clt)..'  Equipe N°:'..$(Equipe)..' Du '..$(Critere)..'  Tps Equipe -> '..$(Tps_best)</text> -->
			</before>
		</rupture>
		
		<body>
			<call option="color_alternate" file="./edition/options.xml" />
			<font size="9" adjust="ellipsize"/>
			<pen border="none" />
			<row h="auto"/>
			<spacing left="5" right="10" top="2" bottom="2" />
			<!-- <text col="4" align="right" label="Dos">$(Clt)</text> -->
			<text col="4" align="right" label="Dos">$(Dossard)</text>
			<!-- <text col="7" align="center" label="Code"><font size="8" cond="group =='body'"/>$(Code_coureur):sub(4)</text> -->
			<text col="20" align="left" label="Nom - Prénom">GetIdentiteCoureur(officiel)</text> 
			<text col="4" align="center" label="An">$(An)</text>
			<text col="6" align="center" label="Categ">$(Categ)</text>
			<text col="4" align="center" label="S.">$(Sexe)</text>
			<text col="4" align="center" label="Dist.">$(Distance)</text>
			<text col="7" align="center" label="Dist.">$(Tps)</text>
			<text col="4" align="center" label="Dist.">$(Tps_best)</text>
			<line col_start="1" col_end="0" pen_size="4" border="bottom" cond="not _context_border"/>
		</body>
	</report>	

	
</edition>

